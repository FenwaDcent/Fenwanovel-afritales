<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Testimony: The Irony of Destiny ‚Äì Fenwanovels</title>
  <meta name="description" content="Testimony: The Irony of Destiny by Ajibade Vincent Adefenwa">
  <link rel="stylesheet" href="../../assets/styles.css"/>

  <style>
    /* small fixes so light mode looks clean */
    :root{--chip-bg:#eceef2;--card-bg:#f6f7f9}
    html[data-theme="dark"]{--chip-bg:#262626;--card-bg:#111}
    .book-hero img{width:100%;max-width:420px;height:auto;border-radius:14px;display:block}
    .chips{display:flex;gap:.5rem;flex-wrap:wrap;margin:.5rem 0 1rem}
    .chip{background:var(--chip-bg);color:inherit;border-radius:999px;padding:.35rem .7rem;font-size:.85rem}
    .chapter{background:var(--card-bg);padding:16px;border-radius:14px;margin:18px 0}
    .chapter h3{margin:0 0 .35rem}
    .chapter .meta{opacity:.75;font-size:.92rem;margin-bottom:.6rem}
    .toolbar{display:flex;gap:.75rem;align-items:center;margin:.75rem 0 1rem}
    .toolbar a,.toolbar button{font-weight:600}
    .toc{margin:12px 0 18px;display:flex;flex-wrap:wrap;gap:.5rem}
    .toc a{background:var(--chip-bg);padding:.35rem .6rem;border-radius:999px;font-size:.86rem;text-decoration:none}
    .lock{border:2px dashed #6663;border-radius:12px;padding:14px}
    .content p{line-height:1.8}
  </style>
</head>
<body>
<header>
  <div class="header-inner">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div class="title">Fenwanovels</div>
    </div>
    <div class="badges">
      <div class="coin">üí∞ <span class="coin-amount">85</span> Coins</div>
      <button class="toggle" onclick="toggleTheme()"><span id="themeText">üåô Dark</span></button>
    </div>
  </div>
</header>

<main>
  <article>
    <h1>Testimony: The Irony of Destiny</h1>

    <div class="book-hero">
      <img src="../../assets/covers/testimony-the-irony-of-destiny.jpg" alt="Testimony: The Irony of Destiny cover">
    </div>

    <div class="chips">
      <span class="chip">Faith</span>
      <span class="chip">Romance</span>
      <span class="chip">Inspiration</span>
    </div>

    <p class="dim">
      By Ajibade Vincent Adefenwa. A powerful Nigerian story of love, betrayal, redemption, and the faith that turns pain into purpose.
    </p>

    <div class="toolbar">
      <a class="btn" href="../../index.html">‚Üê Back to Library</a>
      <a class="btn" href="#toc">Jump to Chapters</a>
    </div>

    <!-- TOC will be generated here -->
    <div id="toc" class="toc"></div>

    <!-- Chapters will be generated here -->
    <div id="chapters"></div>
  </article>
</main>

<footer>
  <div>¬© <span id="year"></span> Fenwanovels ‚Ä¢ All rights reserved.</div>
  <div class="credit">Written by Ajibade Vincent Adefenwa</div>
</footer>

<script src="../../assets/app.js"></script>
<script>
  document.getElementById('year').textContent = new Date().getFullYear();

  // ==== Page config ====
  const BOOK_KEY = 'testimony-the-irony-of-destiny';
  const PRICE = 30;                // per locked chapter
  const TOTAL = 50;
  const FREE = new Set([1,2,3,4,5]);

  // Ensure coin badge reflects storage
  document.addEventListener('DOMContentLoaded', () => {
    if (typeof getCoins === 'function') {
      // use your existing app.js helpers
      const c = getCoins();
      if (!Number.isFinite(c)) setCoins(85);
      else setCoins(c);
    }
  });

  // Build TOC + Chapter sections
  const toc = document.getElementById('toc');
  const wrap = document.getElementById('chapters');

  for (let i = 1; i <= TOTAL; i++) {
    // TOC
    const a = document.createElement('a');
    a.href = `#ch${i}`;
    a.textContent = `Ch. ${i}`;
    toc.appendChild(a);

    // Chapter section
    const sec = document.createElement('section');
    sec.id = `ch${i}`;
    sec.className = 'chapter';
    sec.dataset.ch = String(i);

    const h = document.createElement('h3');
    h.innerHTML = `Chapter ${i}: <span class="meta">Untitled</span>`;
    sec.appendChild(h);

    if (FREE.has(i)) {
      // Free chapter content placeholder
      const body = document.createElement('div');
      body.className = 'content';
      body.id = `content-${i}`;
      body.innerHTML = `
        <p>[Paste the FULL text of Chapter ${i} here.]</p>
      `;
      sec.appendChild(body);
    } else {
      // Locked
      const lock = document.createElement('div');
      lock.className = 'lock';
      lock.id = `lock-${i}`;
      lock.innerHTML = `
        <p class="dim">This chapter is locked. Unlock with <strong>${PRICE} Coins</strong>.</p>
        <button class="btn primary" onclick="unlock(${i}, ${PRICE})">Unlock (${PRICE} Coins)</button>
      `;
      sec.appendChild(lock);

      const body = document.createElement('div');
      body.className = 'content';
      body.id = `content-${i}`;
      body.hidden = true;
      body.innerHTML = `
        <p>[Paste the FULL text of Chapter ${i} here. It will become visible after unlock.]</p>
      `;
      sec.appendChild(body);
    }

    wrap.appendChild(sec);
  }

  // === Book-scoped unlock helpers (reuse your global coin logic) ===
  const UNLOCK_KEY = 'unlocked_' + BOOK_KEY;

  function getUnlocked() {
    try { return JSON.parse(localStorage.getItem(UNLOCK_KEY) || '[]'); }
    catch { return []; }
  }
  function saveUnlocked(arr) {
    localStorage.setItem(UNLOCK_KEY, JSON.stringify([...new Set(arr)]));
  }
  function showContent(ch) {
    const lock = document.getElementById('lock-' + ch);
    const body = document.getElementById('content-' + ch);
    if (lock) lock.hidden = true;
    if (body) body.hidden = false;
  }
  function renderLocksFromStorage(){
    getUnlocked().forEach(showContent);
  }
  document.addEventListener('DOMContentLoaded', renderLocksFromStorage);

  // Expose unlock() that uses your add/spend coin helpers from assets/app.js
  window.unlock = function(chapter, price){
    if (getUnlocked().includes(chapter)) { showContent(chapter); return; }
    if (typeof spendCoins !== 'function') { alert('Coin system not loaded.'); return; }
    if (!spendCoins(price)) { alert('Not enough coins. Tap ‚ÄúBuy Coins‚Äù on the home page.'); return; }
    const list = getUnlocked(); list.push(chapter); saveUnlocked(list);
    showContent(chapter);
    alert('üîì Chapter ' + chapter + ' unlocked!');
  };
</script>
</body>
</html>
