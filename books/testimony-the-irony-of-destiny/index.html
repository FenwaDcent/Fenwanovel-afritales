<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Testimony: The Irony of Destiny</title>
  <link rel="stylesheet" href="../../assets/styles.css" />
</head>

<body>

  <!-- Header -->
  <header>
    <h1>Testimony: The Irony of Destiny</h1>
    <button id="themeToggle">ðŸŒ™ Dark</button>
  </header>

  <!-- Main content area -->
  <main>
    <!-- âœ… All your chapter sections go here -->
    <section id="ch1" class="chapter"> ... </section>
    <section id="ch2" class="chapter"> ... </section>
    <section id="ch3" class="chapter"> ... </section>
    <section id="ch4" class="chapter"> ... </section>
    <!-- etc -->
  </main>

  <!-- âœ… Now the Buy Coins Modal (AFTER your content, before </body>) -->
  <div id="buyCoinsModal" class="modal" hidden style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.7);z-index:9999">
    <div class="card" style="background:var(--card);padding:20px;border-radius:14px;max-width:340px;width:90%">
      <h3 style="margin-top:0">Buy Coins</h3>
      <p class="dim">Support the author and unlock more chapters.</p>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
        <button onclick="addCoins(100)">Buy 100 Coins</button>
        <button onclick="closeBuyCoins()">Close</button>
      </div>
    </div>
  </div>

  <!-- âœ… All JavaScript should be placed *after* the modal, just before </body> -->
  <script>
    // Coin logic
    const LS_KEY = 'coins:testimony';
    const LS_UNLOCKED = 'unlocked:testimony';

    function getCoins(){return parseInt(localStorage.getItem(LS_KEY) || '0');}
    function setCoins(n){localStorage.setItem(LS_KEY,n);updateCoinDisplay();}
    function addCoins(n){setCoins(getCoins()+n);alert(`âœ… Added ${n} coins`);closeBuyCoins();}
    function spendCoins(n){
      const balance=getCoins();
      if(balance < n){alert('Not enough coins!');openBuyCoins();return false;}
      setCoins(balance - n);return true;
    }

    function updateCoinDisplay(){
      const el=document.querySelector('#coinDisplay');
      if(el) el.textContent = getCoins();
    }

    // Modal controls
    function openBuyCoins(){
      const m=document.getElementById('buyCoinsModal');
      m.hidden=false;m.style.display='flex';document.body.style.overflow='hidden';
    }
    function closeBuyCoins(){
      const m=document.getElementById('buyCoinsModal');
      m.style.display='none';m.hidden=true;document.body.style.overflow='';
    }

    // Unlock logic
    function unlock(chId,price){
      if(!spendCoins(price))return;
      const s=document.getElementById(`ch${chId}`);
      s.querySelector('.lock').hidden=true;
      s.querySelector('.content').hidden=false;
      alert(`ðŸ”“ Chapter ${chId} unlocked!`);
      const u=JSON.parse(localStorage.getItem(LS_UNLOCKED)||'[]');
      if(!u.includes(chId)){u.push(chId);localStorage.setItem(LS_UNLOCKED,JSON.stringify(u));}
    }

    // Restore unlocked chapters
    (function restore(){
      const u=JSON.parse(localStorage.getItem(LS_UNLOCKED)||'[]');
      u.forEach(ch=>{
        const s=document.getElementById(`ch${ch}`);
        if(s){s.querySelector('.lock').hidden=true;s.querySelector('.content').hidden=false;}
      });
      updateCoinDisplay();
    })();
  </script>
</body>
</html>
